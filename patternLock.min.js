/*
    patternLock.js v 0.8.0
    Author: Sudhanshu Yadav
    Copyright (c) 2015,2016 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo on: ignitersworld.com/lab/patternLock.html
*/
!function(t){var e=Function("return this")()||(42,eval)("this");"function"==typeof define&&define.amd?define(["jquery"],function(n){return e.PatternLock=t(n,e)}):"object"==typeof module&&module.exports?module.exports=e.document?t(require("jquery"),e):function(e){if(!e.document)throw new Error("patternLock requires a window with a document");return t(require("jquery")(e),e)}:e.PatternLock=t(e.jQuery,e)}(function(t,e,n){"use strict";function r(t){for(var e=t.holder,n=t.option,r=n.matrix,i=n.margin,o=n.radius,a=['<ul class="patt-wrap" style="padding:'+i+'px">'],s=0,l=r[0]*r[1];l>s;s++)a.push('<li class="patt-circ" style="margin:'+i+"px; width : "+2*o+"px; height : "+2*o+"px; -webkit-border-radius: "+o+"px; -moz-border-radius: "+o+"px; border-radius: "+o+'px; "><div class="patt-dots"></div></li>');a.push("</ul>"),e.html(a.join("")).css({width:r[1]*(2*o+2*i)+2*i+"px",height:r[0]*(2*o+2*i)+2*i+"px"}),t.pattCircle=t.holder.find(".patt-circ")}function i(t,e,n,r){var i=e-t,o=r-n;return{length:Math.ceil(Math.sqrt(i*i+o*o)),angle:Math.round(180*Math.atan2(o,i)/Math.PI)}}function o(){}function a(e,n){var i=this,s=i.token=Math.random(),u=p[s]=new o,c=u.holder=t(e);if(0!=c.length){u.object=i,n=n||{};var h={onDraw:l},f=n.matrix;f&&f[0]*f[1]>9&&(h.delimiter=","),n=u.option=t.extend({},a.defaults,h,n),r(u),c.addClass("patt-holder"),"static"==c.css("position")&&c.css("position","relative"),c.on("touchstart mousedown",function(t){d.call(this,t,i)});var m=n.mapper;"object"==typeof m?u.mapperFunc=function(t){return m[t]}:"function"==typeof m?u.mapperFunc=m:u.mapperFunc=l,u.option.mapper=null}}var s=e.document,l=function(){},p={},d=function(e,n){e.preventDefault();var r=p[n.token];if(!r.disabled){r.option.patternVisible||r.holder.addClass("patt-hidden");var i="touchstart"==e.type?"touchmove":"mousemove",o="touchstart"==e.type?"touchend":"mouseup";t(this).on(i+".pattern-move",function(t){u.call(this,t,n)}),t(s).one(o,function(){c.call(this,e,n)});var a=r.holder.find(".patt-wrap"),l=a[0].getBoundingClientRect();r.wrapTop=l.top,r.wrapLeft=l.left,n.reset()}},u=function(e,n){e.preventDefault();var r=e.clientX||e.originalEvent.touches[0].clientX,o=e.clientY||e.originalEvent.touches[0].clientY,a=p[n.token],s=a.option,l=a.pattCircle,d=a.patternAry,u=s.lineOnMove,c=a.getIdxFromPoint(r,o),h=c.idx,f=a.mapperFunc(h)||h;if(d.length>0){var m=i(a.lineX1,c.x,a.lineY1,c.y);a.line.css({width:m.length+10+"px",transform:"rotate("+m.angle+"deg)"})}if(h){if(s.allowRepeat&&d[d.length-1]!==f||-1===d.indexOf(f)){console.log("coming twice",d,f);var v,g=t(l[h-1]);if(a.lastPosObj){for(var w=a.lastPosObj,x=w.i,j=w.j,b=Math.abs(c.i-x),y=Math.abs(c.j-j);(0==b&&y>1||0==y&&b>1||y==b&&y>1)&&(j!=c.j||x!=c.i);){x=b?Math.min(c.i,x)+1:x,j=y?Math.min(c.j,j)+1:j,b=Math.abs(c.i-x),y=Math.abs(c.j-j);var k=(j-1)*s.matrix[1]+x,M=a.mapperFunc(k)||k;(s.allowRepeat||-1==d.indexOf(M))&&(t(l[k-1]).addClass("hovered"),d.push(M))}v=[],c.j-w.j>0?v.push("s"):c.j-w.j<0?v.push("n"):0,c.i-w.i>0?v.push("e"):c.i-w.i<0?v.push("w"):0,v=v.join("-")}g.addClass("hovered"),console.log(d,f),d.push(f),console.log("after push",d,f);var P=s.margin,C=s.radius,F=(c.i-1)*(2*P+2*C)+2*P+C,O=(c.j-1)*(2*P+2*C)+2*P+C;if(1!=d.length){var q=i(a.lineX1,F,a.lineY1,O);a.line.css({width:q.length+10+"px",transform:"rotate("+q.angle+"deg)"}),u||a.line.show()}v&&(a.lastElm.addClass(v+" dir"),a.line.addClass(v+" dir"));var E=t('<div class="patt-lines" style="top:'+(O-5)+"px; left:"+(F-5)+'px"></div>');a.line=E,a.lineX1=F,a.lineY1=O,a.holder.append(E),u||a.line.hide(),a.lastElm=g}a.lastPosObj=c}},c=function(t,e){t.preventDefault();var n=p[e.token],r=n.option,i=n.patternAry.join(r.delimiter);n.holder.off(".pattern-move").removeClass("patt-hidden"),i&&(r.onDraw(i),n.line.remove(),n.rightPattern&&(i==n.rightPattern?n.onSuccess():(n.onError(),e.error())))};return o.prototype={constructor:o,getIdxFromPoint:function(t,e){var n=this.option,r=n.matrix,i=t-this.wrapLeft,o=e-this.wrapTop,a=null,s=n.margin,l=2*n.radius+2*s,p=Math.ceil(i/l),d=Math.ceil(o/l),u=i%l,c=o%l;return p<=r[1]&&d<=r[0]&&u>2*s&&c>2*s&&(a=(d-1)*r[1]+p),{idx:a,i:p,j:d,x:i,y:o}}},a.prototype={constructor:a,option:function(t,e){var i=p[this.token],o=i.option;return e===n?o[t]:(o[t]=e,void(("margin"==t||"matrix"==t||"radius"==t)&&r(i)))},getPattern:function(){var t=p[this.token];return(t.patternAry||[]).join(t.option.delimiter)},setPattern:function(t){var e=p[this.token],n=e.option,r=n.matrix,i=n.margin,o=n.radius;if(n.enableSetPattern){"string"==typeof t&&(t=t.split(n.delimiter)),this.reset(),e.wrapLeft=0,e.wrapTop=0;for(var a=0;a<t.length;a++){var s=t[a]-1,d=s%r[1],c=Math.floor(s/r[1]),h=d*(2*i+2*o)+2*i+o,f=c*(2*i+2*o)+2*i+o;u.call(null,{clientX:h,clientY:f,preventDefault:l},this)}}},enable:function(){var t=p[this.token];t.disabled=!1},disable:function(){var t=p[this.token];t.disabled=!0},reset:function(){var t=p[this.token];t.pattCircle.removeClass("hovered dir s n w e s-w s-e n-w n-e"),t.holder.find(".patt-lines").remove(),t.patternAry=[],t.lastPosObj=null,t.holder.removeClass("patt-error")},error:function(){p[this.token].holder.addClass("patt-error")},checkForPattern:function(t,e,n){var r=p[this.token];r.rightPattern=t,r.onSuccess=e||l,r.onError=n||l}},a.defaults={matrix:[3,3],margin:20,radius:25,patternVisible:!0,lineOnMove:!0,delimiter:"",enableSetPattern:!1,allowRepeat:!1},a});
